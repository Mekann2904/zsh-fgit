# zsh-fgit


`fgit` は、`fzf` を使って **ローカルの Git リポジトリを高速に発見・移動**するための zsh 関数である。
ホーム配下（または任意のベースディレクトリ）を走査し、`.git` を持つディレクトリを一覧化して選択すると、その場で `cd` する。加えて **README を全文検索して候補ディレクトリへ絞り込む Grep モード**も備える。

---

## 特長

- **Repos モード**: `.git` を持つディレクトリを一覧表示して選択 → `cd`
- **Grep モード**: `README*` に対する文字列検索で候補ディレクトリを絞り込み
- **プレビュー**:
  - Git ブランチ名と `git status -sb`（先頭20行）
  - README があれば先頭120行を表示（`bat` があれば行番号付き）
  - README がなければディレクトリ概要（`eza --tree` / `tree` / `ls -F`）
- **重いディレクトリを除外**（uv/pip/npm/cargo/conda などのキャッシュ・依存フォルダ）
- `fd`/`rg` があれば高速、なければ `find`/`grep` でフォールバック

---

## 依存関係

必須:
- **zsh**
- **fzf**

推奨（あると高速・快適）:
- **fd**（リポジトリ探索の高速化）
- **ripgrep (rg)**（Grep モードの高速化）
- **bat** または **batcat**（README プレビューの視認性向上）
- **eza** または **tree**（ディレクトリプレビューの見やすさ向上）
- **git**（プレビューでブランチ/ステータス表示に使用）

---

## インストール

1. 任意のファイルに関数を保存する（例: `~/.zsh/functions/fgit.zsh`）
2. `~/.zshrc` などで読み込む

```zsh
source ~/.zsh/functions/fgit.zsh
````

または `.zshrc` にそのまま貼り付けてもよい。

---

## 使い方

### 基本

```zsh
fgit
```

* ベースディレクトリは `"$HOME"` が既定
* 検索深さは `FGIT_DEPTH` が既定（未設定なら 5）

### ベースディレクトリを指定

```zsh
fgit ~/src
```

### 検索深さを変更

```zsh
export FGIT_DEPTH=8
fgit ~/work
```

---

## キー操作（fzf 画面）

* **ENTER**: 選択したディレクトリへ移動（`cd`）
* **CTRL-G**: モード切替

  * `Repos> ` ↔ `Grep> `
* `Grep> ` のときは入力に応じて候補が再ロードされる（README 検索）

---

## 動作概要

### Repos モード（`Repos> `）

* `.git`（ディレクトリまたはファイル）を手掛かりにリポジトリルートを列挙する
* 除外ディレクトリ（後述）を避けつつ、既定で深さ `FGIT_DEPTH` まで探索する

### Grep モード（`Grep> `）

* `README*` を対象にクエリを検索し、マッチした README が存在するディレクトリ（=その親）を候補にする
* `fd` がある場合は `rg` ベース、ない場合は `grep -rl` ベースにフォールバックする

---

## 除外ディレクトリ

コード内で次を除外対象としている（必要に応じて編集する）:

* `.cache`, `anaconda3`, `miniconda3`, `.conda`
* `.npm`, `node_modules`
* `.cargo`
* `.pyenv`, `.rbenv`
* `Library`, `.local`, `go`

---

## カスタマイズ

### 1) 除外ディレクトリを増減する

`ignore_dirs=( ... )` を編集する。

### 2) README プレビュー行数を変える

`cat_cmd` の `head -n 120` / `--line-range :120` を変更する。

### 3) ディレクトリプレビューの深さを変える

`eza --tree --level=2` / `tree -L 2` の数値を変更する。

---

## 既知の制約・注意点

* **`fd` がない場合の Grep モード**は `grep -rl` を使うため、環境によっては遅い（特にベースディレクトリが広い場合）。高速化したいなら `fd` と `rg` を推奨する。
* フォールバック実装は環境差（BSD/GNU の `grep` や `sed` の差）に左右される可能性がある。挙動が怪しい場合は `fd`/`rg` を導入するのが最も確実である。
* `Repos` 探索は `.git` を手掛かりにするため、サブモジュールや特殊な構成（ワークツリー/リンク）では想定外の候補が出る場合がある。

---

## 例: よくある使い方

* 「どこに clone したか忘れたリポジトリへ即移動」
  `fgit` → 絞り込み → ENTER
* 「README に “docker” が書いてあるプロジェクトを探す」
  `fgit` → CTRL-G → `docker` と入力 → ENTER


